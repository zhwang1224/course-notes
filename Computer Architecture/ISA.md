# 1.3 计算机体系结构
# 1.3.1 
1. ARMv8要求操作对象必须对齐，80x86和RISC-V不要求对齐，但是对齐后访问速度会更快。

# 附录A
## A.2 ISA的分类
1. 两类寄存器计算机：一类可以用任意指令来访问存储器，称为**寄存器-存储器体系结**构；另一类只能用载入或存储指令来访问存储器，称为**载入-存储体系结构**。第三类将所有操作数保存在存储器中的体系结构，即存储器-存储器体系结构目前已经没有了。
2. 通用寄存器（GPR）:1.寄存器快于存储器。2.对编译器来说，寄存器效率高于其他内部存储形式。寄存器计算机可以按任意顺序执行乘法计算，结合流水线因素，这么做可能效率更高。
   1. 寄存器可用于保存变量，可降低内存访问量、加快程序速度、提高代码密度（名称位数小于内存地址位数）。
   2. 大多数编译器会为表达式求值保留一些寄存器，为参数传递使用一些寄存器，其他寄存器可以保存变量。
3. 两个重要指令集特性区分GPR体系结构，即ALU指令的操作数性质
   1. ALU指令是两个还是三个操作数。
   2. ALU指令有多少操作数可以是内存地址。
   3. 即载入存储（寄存器-寄存器）ARM,MIPS,PowerPC,SPARC,RISC-V ，寄存器-存储器，存储器-存储器。

## A.3 存储器寻址
1. 小端字节排序，将数据的低位存储到内存的低位；大端将数据的低位存储到内存的高位。
2. 访问对齐：A mod s =0,即字节地址对大小为s字节的对象访问是对齐的。
   1. 存储器对齐边界通常是单字或双字的整数倍，所以非对齐访问会增加硬件复杂度；一个非对齐存储器访问可能需要多个对齐存储器访问。因此对于即使是允许非对齐访问的计算机中，采用对齐访问的程序也可以运行的更快一些。
   2. 对于低n位或者高n位的地址中读取字节时，需要右移或者左移n位，以对齐字节到64位寄存器的适当位置。
   
### A.3.2 寻址方式
- 寄存器寻址      Add R4, R3
- 立即数寻址      Add R4, 3
- 位移量寻址      Add R4, 100(R1)       100+Regs[1]
- 寄存器间接寻址  Add R4, (R1)          寄存器R1中是地址  
- 索引寻址        Add R3, (R1+R2)      有时用于数组寻址：R1为数组的基址，R2为索引值
- 直接或绝对寻址  Add R1, (1001)         访问静态数据
- 存储器间接寻址  Add R1, @(R3)           R3为指针p的地址
- 自动递增寻址    Add R1, (R2)+          循环内部遍历数组，每次引用R值会增大一个元素的大小d
- 自动递减寻址    Add R1, -(R2)           push/pop
- 比例寻址        Add R1, 100(R2)[R3]     1 = 1+2+3*d

位移量寻址和立即数寻址最多。

### A.3.3 位移量寻址方式
- 位移值的分布非常广泛。

### A.3.4 立即数寻址方式
- 整数程序大约五分之一指令使用立即数，浮点六分之一
- 小立即数应用得最多。不过，有时也会使用大立即数

## A.4 操作数类型和大小
1. 类型
   - 字符（8位）、半字（16位）、字（32位）、单精度浮点（32位/字）、双精度浮点（64位/2个字）。
   - 双字和字的访问最多。

## A.5 指令集中的操作
1. 指令操作符
- 算术与逻辑      整数算术和逻辑运算: 加减与或乘除
- 数据传输        载入-存储
- 控制            分支，跳转，过程调用与返回、陷入
- 系统            操作系统调用、虚拟内存管理指令
- 浮点            浮点运算：加乘除、比较
- 十进制          十进制加、乘、二进制到字符的转换
- 字符串          字符串移动、比较、搜索
- 图形            像素顶点操作、压缩和解压缩

所有计算机都提供前三类一整套操作。
载入、条件分支、比较、存储比较多。（80x86）

## A.6 控制流指令
可叫转移transfer, 分支branch。如果无条件则是 跳转jump，有条件，分支branch。

- 条件分支
- 跳转
- 过程调用
- 过程返回
条件分支占绝大多数

### A.6.1 控制流指令的寻址方式

## A.7 指令集编码
- 变长编码、定长编码、混合编码

## A.9 RISC-V
- 有32位和64位版本
### A.9.1 RISC-V指令集组织方式
- 有三个基本指令集和其他的扩展指令集
### A.9.2 RISC-V寄存器
- 32个 64位寄存器GPR/或证书寄存器 以及32个浮点寄存器 可保存32个单双精度值。
### A.9.5 RISC-V指令格式
立即数寻址和位移量寻址
- R格式 寄存器型指令
- I格式 立即数指令
- S格式 访存指令
- B格式 跳转指令 beq x19, x10, end 相等跳转到end bgt不等于
- U格式 载入高位
- J格式 jal jalr 跳转并链接 跳转并链接到寄存器